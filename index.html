<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EVM Multi Wallet Checker</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body{margin:0;background:#0b1020;color:#e5e7eb;font:14px/1.45 sans-serif}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    .header{display:flex;justify-content:space-between;align-items:center}
    .grid{display:grid;gap:16px;grid-template-columns:380px 1fr;margin-top:16px}
    .card{background:#111827;border-radius:10px;padding:14px}
    textarea,input{width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #1f2a44;background:#0e152a;color:#e5e7eb}
    textarea{height:140px}
    button{margin-top:8px;padding:8px 12px;border:0;border-radius:6px;cursor:pointer}
    button.primary{background:#10b981;color:#001b10;font-weight:700}
    table{width:100%;border-collapse:collapse;table-layout:auto}
    th,td{padding:8px;border-bottom:1px solid #1f2a44;text-align:left}
    td.address{word-break:break-all;white-space:normal}
    .pill{padding:4px 8px;border:1px solid #1f2a44;border-radius:999px;font-size:12px;margin-right:6px}
    .ok{color:#34d399}.err{color:#fb7185}
    .stats{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}
    .total-balance{font-size:18px;font-weight:bold;text-align:right;margin-top:12px}
  </style>
</head>
<body>
<div class="container">
  <div class="header"><h2>⚡ EVM Multi Wallet Checker</h2><span style="font-size:12px;color:#94a3b8">ethers.js + SheetJS</span></div>

  <div class="grid">
    <div class="card">
      <label>Wallet addresses (1 per line)</label>
      <textarea id="addrInput" placeholder="0xabc...\n0xdef..."></textarea>
      <input type="file" id="fileInput" accept=".csv, .xlsx, .xls" />
      <button id="btnImport">Import CSV/XLSX</button>
      <label>Custom RPC URL</label>
      <input id="rpcUrl" placeholder="https://rpc.ankr.com/eth"/>
      <label>Concurrency</label>
      <input id="concurrency" type="number" value="6"/>
      <label>Timeout (ms)</label>
      <input id="timeout" type="number" value="15000"/>
      <label>Custom Symbol</label>
      <input id="customSymbol" placeholder="ETH"/>
      <button class="primary" id="btnCheck">Check Wallets</button>
      <button id="btnStop">Stop</button>
      <button id="btnExportCsv">Export CSV</button>
      <button id="btnExportXlsx">Export XLSX</button>
    </div>

    <div class="card">
      <div class="stats">
        <span class="pill">Total: <span id="statTotal">0</span></span>
        <span class="pill ok">OK: <span id="statOk">0</span></span>
        <span class="pill err">ERR: <span id="statErr">0</span></span>
        <span class="pill">Duration: <span id="statDur">0s</span></span>
      </div>
      <div style="overflow-y:auto;max-height:60vh">
        <table id="resultTable">
          <thead><tr><th>#</th><th>Address</th><th>Balance</th><th>Nonce</th><th>Status</th><th>Message</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="total-balance">Total Balance: <span id="statSum">0</span> <span id="unitName">ETH</span></div>
    </div>
  </div>
</div>

<script>
(() => {
  const { ethers } = window;
  const el = id => document.getElementById(id);
  const tbody = document.querySelector('#resultTable tbody');
  const statTotal=el('statTotal'), statOk=el('statOk'), statErr=el('statErr'), statDur=el('statDur'), statSum=el('statSum'), unitName=el('unitName');
  let controller={stop:false}, results=[], sum=0;

  const normalizeAddrs = text => (text||'').split(/\r?\n|,|\s+/).map(s=>s.trim()).filter(Boolean);

  function addRow(i,addr){
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td class="address">${addr}</td><td data-k="bal">-</td><td data-k="nonce">-</td><td data-k="status">…</td><td data-k="msg"></td>`;
    tbody.appendChild(tr);return tr;
  }

  async function checkOne(provider,addr,i,row,symbol){
    const out={index:i+1,address:addr,balance:null,nonce:null,status:"OK",message:""};
    try{
      if(!ethers.utils.isAddress(addr)) throw new Error("Invalid address");
      const balWei=await provider.getBalance(addr);
      const nonce=await provider.getTransactionCount(addr);
      const ether=ethers.utils.formatEther(balWei);
      row.querySelector('[data-k=bal]').textContent=ether+" "+symbol;
      row.querySelector('[data-k=nonce]').textContent=nonce;
      row.querySelector('[data-k=status]').innerHTML='<span class="ok">OK</span>';
      out.balance=ether;out.nonce=nonce;
      sum+=parseFloat(ether);statSum.textContent=sum.toFixed(6);
      return out;
    }catch(e){
      row.querySelector('[data-k=status]').innerHTML='<span class="err">ERR</span>';
      row.querySelector('[data-k=msg]').textContent=e.message;
      out.status="ERR";out.message=e.message;return out;
    }
  }

  async function run(){
    controller.stop=false;results=[];tbody.innerHTML='';sum=0;statSum.textContent='0';
    const addrs=normalizeAddrs(el('addrInput').value);statTotal.textContent=addrs.length;
    const url=el('rpcUrl').value.trim();const symbol=(el('customSymbol').value||'ETH').toUpperCase();unitName.textContent=symbol;
    if(!addrs.length) return alert('Isi alamat dulu'); if(!url) return alert('Isi RPC URL');
    const provider=new ethers.providers.JsonRpcProvider({url,timeout:Number(el('timeout').value||15000)});
    const rows=addrs.map((a,i)=>addRow(i,a));
    let ok=0,err=0,start=Date.now();
    let cursor=0,pool=Number(el('concurrency').value||6);
    async function worker(){
      while(!controller.stop && cursor<addrs.length){
        const i=cursor++;const res=await checkOne(provider,addrs[i],i,rows[i],symbol);
        results[i]=res;(res.status==='OK'?ok++:err++);
        statOk.textContent=ok;statErr.textContent=err;statDur.textContent=((Date.now()-start)/1000).toFixed(1)+'s';
      }
    }
    await Promise.all(Array.from({length:Math.min(pool,addrs.length)},worker));
  }

  el('btnCheck').onclick=run;el('btnStop').onclick=()=>controller.stop=true;
  function exportSheet(type){if(!results.length) return alert('Belum ada hasil');const symbol=(el('customSymbol').value||'ETH').toUpperCase();const rows=[["#","Address","Balance ("+symbol+")","Nonce","Status","Message"]];results.forEach(r=>rows.push([r.index,r.address,r.balance? r.balance+" "+symbol:"",r.nonce,r.status,r.message]));const ws=XLSX.utils.aoa_to_sheet(rows);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'Wallets');const fname='wallet-check-'+Date.now()+(type==='csv'?'.csv':'.xlsx');XLSX.writeFile(wb,fname,{bookType:type==='csv'?'csv':'xlsx'});}
  el('btnExportCsv').onclick=()=>exportSheet('csv');el('btnExportXlsx').onclick=()=>exportSheet('xlsx');
})();
</script>
</body>
</html>
