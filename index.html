<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EVM Multi Wallet Checker</title>
  <!-- Simple, build-free stack: pure HTML + JS (NO Java, NO bundler) -->
  <!-- Libraries from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    :root{--bg:#0b1020;--panel:#0f172a;--text:#e5e7eb;--muted:#94a3b8;--brand:#10b981;--border:#1f2a44}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1020,#0b1020 220px,#0d1326 221px);color:var(--text);font:14px/1.45 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
    .container{max-width:1100px;margin:0 auto;padding:24px 16px}
    .header{display:flex;gap:12px;align-items:center}
    .title{font-size:20px;font-weight:800;letter-spacing:.2px}
    .badge{margin-left:auto;font-size:12px;color:var(--muted)}
    .grid{display:grid;gap:16px;grid-template-columns:1fr 320px}
    .card{background:rgba(16,24,40,.6);border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25);backdrop-filter: blur(6px)}
    .card .inner{padding:14px}
    label{display:block;color:var(--muted);font-size:12px;margin-top:8px}
    textarea,input,select{width:100%;margin-top:6px;border-radius:10px;border:1px solid var(--border);background:#0e152a;color:var(--text);padding:10px 12px}
    textarea{height:140px;resize:vertical}
    .row{display:flex;gap:8px;align-items:center}
    .btn{display:inline-flex;align-items:center;gap:8px;border-radius:10px;border:1px solid var(--border);padding:10px 12px;background:#111827;color:#fff;cursor:pointer}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#001b10;font-weight:700}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:middle}
    th{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.04em}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .small{font-size:12px;color:var(--muted)}
    .right{margin-left:auto}
    .drag{border:1px dashed var(--border);border-radius:10px;text-align:center;padding:10px;color:var(--muted);font-size:12px}
    .pill{padding:.2rem .55rem;border:1px solid var(--border);border-radius:999px;font-size:12px;color:var(--muted)}
    .ok{color:#34d399}
    .err{color:#fb7185}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title">⚡ EVM Multi Wallet Checker</div>
      <div class="badge">HTML + JavaScript (no Java)</div>
    </div>

    <div class="grid" style="margin-top:16px">
      <!-- Left: inputs -->
      <div class="card">
        <div class="inner">
          <div class="row" style="gap:12px; align-items:flex-start">
            <div style="flex:1">
              <label>Wallet addresses (1 per line)</label>
              <textarea id="addrInput" placeholder="0xabc...\n0xdef...\n0x..."></textarea>
              <div class="row" style="margin-top:8px">
                <input type="file" id="fileInput" accept=".csv, .xlsx, .xls" />
                <button class="btn" id="btnImport">Import CSV/XLSX</button>
                <span class="pill" id="addrCount">0 addr</span>
              </div>
              <div class="drag small" style="margin-top:8px">Tip: bisa drag & drop file CSV/XLSX ke area ini</div>
            </div>
            <div style="width:320px">
              <label>Custom RPC URL</label>
              <input id="rpcUrl" placeholder="https://rpc.ankr.com/eth"/>
              <label>Concurrency</label>
              <input id="concurrency" type="number" min="1" max="20" value="6"/>
              <label>Timeout (ms)</label>
              <input id="timeout" type="number" min="1000" step="500" value="15000"/>
              <div class="row" style="margin-top:10px">
                <button class="btn primary" id="btnCheck">Check Wallets</button>
                <button class="btn" id="btnStop">Stop</button>
              </div>
              <div class="row" style="margin-top:10px">
                <button class="btn" id="btnExportCsv">Export CSV</button>
                <button class="btn" id="btnExportXlsx">Export XLSX</button>
              </div>
              <div class="small" style="margin-top:8px">Native balance ditampilkan dalam <span id="unitName">ether</span>.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right: results -->
      <div class="card">
        <div class="inner">
          <div class="row toolbar">
            <span class="pill">Total: <span id="statTotal">0</span></span>
            <span class="pill ok">OK: <span id="statOk">0</span></span>
            <span class="pill err">ERR: <span id="statErr">0</span></span>
            <span class="pill right">Duration: <span id="statDur">0s</span></span>
          </div>
          <div style="overflow:auto; max-height: 60vh; margin-top:8px">
            <table id="resultTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Address</th>
                  <th class="right">Balance</th>
                  <th>Nonce</th>
                  <th>Status</th>
                  <th>Message</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <footer class="small">© 2025 Multi Wallet Checker · Built with ethers.js v5 + SheetJS</footer>
  </div>

<script>
(() => {
  const { ethers } = window;
  const el = (id) => document.getElementById(id);
  const addrInput = el('addrInput');
  const fileInput = el('fileInput');
  const btnImport = el('btnImport');
  const btnCheck = el('btnCheck');
  const btnStop = el('btnStop');
  const btnExportCsv = el('btnExportCsv');
  const btnExportXlsx = el('btnExportXlsx');
  const rpcUrl = el('rpcUrl');
  const concurrencyEl = el('concurrency');
  const timeoutEl = el('timeout');
  const unitName = el('unitName');
  const statTotal = el('statTotal');
  const statOk = el('statOk');
  const statErr = el('statErr');
  const statDur = el('statDur');
  const tbody = document.querySelector('#resultTable tbody');

  let controller = { stop: false };
  let results = [];

  const normalizeAddrs = (text) => {
    return (text || '')
      .split(/\r?\n|,|\s+/)
      .map(s => s.trim())
      .filter(s => s.length > 0);
  };

  const setCount = () => {
    const count = normalizeAddrs(addrInput.value).length;
    el('addrCount').textContent = count + ' addr';
    statTotal.textContent = count;
  };

  addrInput.addEventListener('input', setCount);
  setCount();

  // File import (CSV/XLSX)
  async function readFile(file) {
    const data = await file.arrayBuffer();
    const wb = XLSX.read(data, { type: 'array' });
    const sheet = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1, raw: true });
    // Flatten to single column of addresses
    const addrs = [];
    rows.forEach(row => {
      (row || []).forEach(cell => {
        if (typeof cell === 'string') {
          addrs.push(cell.trim());
        } else if (cell != null) {
          addrs.push(String(cell).trim());
        }
      });
    });
    return addrs.filter(Boolean);
  }

  btnImport.addEventListener('click', async () => {
    const f = fileInput.files && fileInput.files[0];
    if (!f) { alert('Pilih file CSV/XLSX dulu'); return; }
    try {
      const addrs = await readFile(f);
      const current = normalizeAddrs(addrInput.value);
      const merged = [...current, ...addrs];
      // unique (case-insensitive)
      const uniq = Array.from(new Map(merged.map(a => [a.toLowerCase(), a])).values());
      addrInput.value = uniq.join('\n');
      setCount();
    } catch (e) {
      alert('Gagal import: ' + e.message);
    }
  });

  // Drag & drop
  document.addEventListener('dragover', e => { e.preventDefault(); });
  document.addEventListener('drop', async e => {
    e.preventDefault();
    if (!e.dataTransfer.files.length) return;
    const f = e.dataTransfer.files[0];
    try {
      const addrs = await readFile(f);
      addrInput.value = addrs.join('\n');
      setCount();
    } catch (err) { alert(err.message); }
  });

  function addRow(i, address) {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="small">${i+1}</td>
      <td class="mono">${address}</td>
      <td class="mono right" data-k="bal">-</td>
      <td class="mono" data-k="nonce">-</td>
      <td class="small" data-k="status">…</td>
      <td class="small" data-k="msg"></td>
    `;
    tbody.appendChild(tr);
    return tr;
  }

  async function checkOne(provider, address, i, row) {
    const out = { index: i+1, address, balance: null, nonce: null, status: 'OK', message: '' };
    try {
      if (!ethers.utils.isAddress(address)) throw new Error('Invalid address');
      const balWei = await provider.getBalance(address);
      const nonce = await provider.getTransactionCount(address);
      const ether = ethers.utils.formatEther(balWei);
      row.querySelector('[data-k="bal"]').textContent = ether;
      row.querySelector('[data-k="nonce"]').textContent = nonce;
      row.querySelector('[data-k="status"]').innerHTML = '<span class="ok">OK</span>';
      out.balance = ether; out.nonce = nonce;
      return out;
    } catch (e) {
      row.querySelector('[data-k="status"]').innerHTML = '<span class="err">ERR</span>';
      row.querySelector('[data-k="msg"]').textContent = e.message || String(e);
      out.status = 'ERR'; out.message = e.message || String(e);
      return out;
    }
  }

  async function run() {
    controller.stop = false; results = []; tbody.innerHTML = '';
    const addrs = normalizeAddrs(addrInput.value);
    if (addrs.length === 0) { alert('Isi alamat dulu'); return; }
    const url = (rpcUrl.value || '').trim();
    if (!url) { alert('Isi RPC URL'); return; }

    const start = Date.now(); let ok=0, err=0;
    unitName.textContent = 'ether';

    // Provider w/ timeout
    const provider = new ethers.providers.JsonRpcProvider({ url, timeout: Number(timeoutEl.value||15000) });

    // pre-render rows
    const rows = addrs.map((a,i)=>addRow(i,a));

    const pool = Number(concurrencyEl.value || 6);
    let cursor = 0;

    async function worker() {
      while (!controller.stop && cursor < addrs.length) {
        const i = cursor++;
        const res = await checkOne(provider, addrs[i], i, rows[i]);
        results[i] = res; (res.status==='OK'? ok++ : err++);
        statOk.textContent = ok; statErr.textContent = err; statDur.textContent = ((Date.now()-start)/1000).toFixed(1)+'s';
      }
    }

    await Promise.all(Array.from({length: Math.min(pool, addrs.length)}, worker));
  }

  btnCheck.addEventListener('click', run);
  btnStop.addEventListener('click', ()=> controller.stop = true);

  function exportSheet(type) {
    if (!results.length) { alert('Belum ada hasil'); return; }
    const rows = [['#','Address','Balance (ether)','Nonce','Status','Message']];
    results.forEach(r => rows.push([r?.index||'', r?.address||'', r?.balance||'', r?.nonce||'', r?.status||'', r?.message||'']));
    const ws = XLSX.utils.aoa_to_sheet(rows);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Wallets');
    const fname = 'wallet-check-'+new Date().toISOString().slice(0,19).replace(/[:T]/g,'-')+(type==='csv'?'.csv':'.xlsx');
    if (type==='csv') XLSX.writeFile(wb, fname, { bookType:'csv' });
    else XLSX.writeFile(wb, fname);
  }
  btnExportCsv.addEventListener('click', ()=>exportSheet('csv'));
  btnExportXlsx.addEventListener('click', ()=>exportSheet('xlsx'));
})();
</script>
</body>
</html>